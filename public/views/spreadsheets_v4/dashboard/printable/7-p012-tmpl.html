<%


function drawCharts(spreadsheet,activeSheet) {
var activeSheetName=activeSheet;
var query1 = new google.visualization.Query(
      'https://docs.google.com/spreadsheets/d/'+spreadsheet.googleId+'/gviz/tq?sheet='+activeSheetName+'&transpose=1&headers=-1&merge=ROWS&range=B11:F11,B20:F20,B19:F19,B18:F18,B17:F17,B16:F16,B15:F15,B14:F14,B13:F13,B12:F12&pli=1'); 

query1.send(handleQueryResponse1);
var query2 = new google.visualization.Query(
      'https://docs.google.com/spreadsheets/d/'+spreadsheet.googleId+'/gviz/tq?sheet='+activeSheetName+'&transpose=0&headers=-1&merge=COLS&range=B12:B20,C12:C20&pli=1'); 
query2.send(handleQueryResponse2);

var query3 = new google.visualization.Query(
      'https://docs.google.com/spreadsheets/d/'+spreadsheet.googleId+'/gviz/tq?sheet='+activeSheetName+'&transpose=0&headers=-1&merge=COLS&range=B12:B20,D12:D20&pli=1'); 
query3.send(handleQueryResponse3);


var query4 = new google.visualization.Query(
      'https://docs.google.com/spreadsheets/d/'+spreadsheet.googleId+'/gviz/tq?sheet='+activeSheetName+'&transpose=0&headers=-1&merge=COLS&range=B12:B20,E12:E20&pli=1'); 
query4.send(handleQueryResponse4);

var query5 = new google.visualization.Query(
      'https://docs.google.com/spreadsheets/d/'+spreadsheet.googleId+'/gviz/tq?sheet='+activeSheetName+'&transpose=0&headers=-1&merge=COLS&range=B12:B20,F12:F20&pli=1'); 
query5.send(handleQueryResponse5);

var query6 = new google.visualization.Query(
      'https://docs.google.com/spreadsheets/d/'+spreadsheet.googleId+'/gviz/tq?sheet='+activeSheetName+'&range=B11:F18&pli=1'); 
query6.send(handleQueryResponse6);



var query7 = new google.visualization.Query(
      'https://docs.google.com/spreadsheets/d/'+spreadsheet.googleId+'/gviz/tq?sheet='+activeSheetName+'&range=B11:F27&pli=1'); 
query7.send(handleQueryResponse7);

}

function handleQueryResponse1(response) {
   
  if (response.isError()) {
    alertify.error('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }

var j=

{"chartType":"ColumnChart","view":{"columns":[{"sourceColumn":0},1,2,3,4,5,6,7]},"dataTable":response.getDataTable(),"options":{"series":{"0":{"color":"#618EC4"},"1":{"color":"#D2803C"},"2":{"color":"#4092A8"},"3":{"color":"#6D558A"},"4":{"color":"#849F4C"},"5":{"color":"#A34441"},"6":{"color":"#436EA1"}},chartArea: {  width: "50%", height: "70%" },"title":"Numero di pazienti per farmaco","height":400,"width":600,"legendTextStyle":{"color":"#222","fontSize":"9"},"legend":{"position":"right", textStyle: {fontSize: 9}},"is3D":false,"useFirstColumnAsDomain":true,"hAxis":{},"isStacked":true}};
google.visualization.drawChart(j, document.getElementById('chart1'+activeSheetName)); 

}


function handleQueryResponse2(response){

 if (response.isError()) {
    alertify.error('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }

var dataTable=response.getDataTable();
var data=dataTable;



var j = {"chartType":"PieChart","view":{"columns":[{"sourceColumn":0},1]},"dataTable":dataTable,"options":{"colors":["#436EA1","#A34441","#849F4C","#6D558A","#4092A8","#D2803C","#618EC4","#C6625F","#A5C26A"],"title":"","height":400,"legend":{"position":"right",maxLines: 10,textStyle: {fontSize: 9}},"width":800,"is3D":false,"useFirstColumnAsDomain":true,"pieSliceText":"percentage"}};

j.options.title="Distribuzione % dei pazienti per terapia. Anno t0.";
j.options.pieSliceText="none";
j.options.sliceVisibilityThreshold=0;

google.visualization.drawChart(j, document.getElementById('chart2'+activeSheetName)); 


}

function handleQueryResponse3(response){

 if (response.isError()) {
    alertify.error('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }


var dataTable=response.getDataTable();

var j = {"chartType":"PieChart","view":{"columns":[{"sourceColumn":0},1]},"dataTable":dataTable,"options":{"colors":["#436EA1","#A34441","#849F4C","#6D558A","#4092A8","#D2803C","#618EC4","#C6625F","#A5C26A"],"title":"","height":400,"legend":{"position":"right",maxLines: 10,textStyle: {fontSize: 9}},"width":800,"is3D":false,"useFirstColumnAsDomain":true,"pieSliceText":"percentage"}};

j.options.title="Distribuzione % dei pazienti per terapia. Anno t1.";
j.options.pieSliceText="none";
j.options.sliceVisibilityThreshold=0;

google.visualization.drawChart(j, document.getElementById('chart3'+activeSheetName)); 


}

function handleQueryResponse4(response){

 if (response.isError()) {
    alertify.error('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }

var dataTable=response.getDataTable();

var j = {"chartType":"PieChart","view":{"columns":[{"sourceColumn":0},1]},"dataTable":dataTable,"options":{"colors":["#436EA1","#A34441","#849F4C","#6D558A","#4092A8","#D2803C","#618EC4","#C6625F","#A5C26A"],"title":"","height":400,"legend":{"position":"right",maxLines: 10, textStyle: {fontSize: 9}},"width":800,"is3D":false,"useFirstColumnAsDomain":true,"pieSliceText":"percentage"}};

j.options.title="Distribuzione % dei pazienti per terapia. Anno t2.";
j.options.pieSliceText="none";
j.options.sliceVisibilityThreshold=0;
google.visualization.drawChart(j, document.getElementById('chart4'+activeSheetName)); 


}

function handleQueryResponse5(response){

 if (response.isError()) {
    alertify.error('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }

var dataTable=response.getDataTable();

var j = {"chartType":"PieChart","view":{"columns":[{"sourceColumn":0},1]},"dataTable":dataTable,"options":{"colors":["#436EA1","#A34441","#849F4C","#6D558A","#4092A8","#D2803C","#618EC4","#C6625F","#A5C26A"],"title":"","height":400,"legend":{"position":"right",maxLines: 10,   textStyle: {fontSize: 9}},"width":800,"is3D":false,"useFirstColumnAsDomain":true,"pieSliceText":"percentage"}};

j.options.title="Distribuzione % dei pazienti per terapia. Anno t3.";
j.options.pieSliceText="none";
j.options.sliceVisibilityThreshold=0;
google.visualization.drawChart(j, document.getElementById('chart5'+activeSheetName)); 


}


function handleQueryResponse6(response) {
   
  if (response.isError()) {
    alertify.error('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }

  var datatable = new google.visualization.DataView(response.getDataTable());
  var table = new google.visualization.Table(document.getElementById('dataTable1'+activeSheetName));
  table.draw(datatable,{'sort':'disable',cssClassNames: {headerCell: 'googleHeaderCell'}});

}

function handleQueryResponse7(response) {
   
  if (response.isError()) {
    alertify.error('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }
  
  var datatable = new google.visualization.DataView(response.getDataTable());
  datatable.setRows([7,8,9,10,11,12,13]);
  var table = new google.visualization.Table(document.getElementById('dataTable2'+activeSheetName));
  table.draw(datatable,{'sort':'disable',cssClassNames: {headerCell: 'googleHeaderCell'}});

}



drawCharts(data.record,activeSheetName);

%>
<div class="row">
  <div class="col-md-12">
        <div class="panel panel-default">
      <div class="panel-body">
        <div id='textNote'><%print(textNote);%></div>
      </div>
    </div>
</div>
</div>
<div class="endpage"></div>
<div class="row">
    <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div id="chart1<%=activeSheetName%>" ><div id="ajax-spinner" style="z-index: 100;"><img src="/media/ajax-pulse.gif"/></div></div>
      </div>
    </div>
  </div>
</div>
<div class="endpage"></div>
<div class="row">
<div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div id="chart2<%=activeSheetName%>" ><div id="ajax-spinner" style="z-index: 100;"><img src="/media/ajax-pulse.gif"/></div></div>
         
       
      </div>
    </div>
  </div>
</div>
<div class="endpage"></div>
<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div id="chart3<%=activeSheetName%>" ><div id="ajax-spinner" style="z-index: 100;"><img src="/media/ajax-pulse.gif"/></div></div>
      </div>
    </div>
  </div>
</div>
<div class="endpage"></div>
<div class="row">
    <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div id="chart4<%=activeSheetName%>" ><div id="ajax-spinner" style="z-index: 100;"><img src="/media/ajax-pulse.gif"/></div></div>
      </div>
    </div>
  </div>
</div>
<div class="endpage"></div>
<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-body">
        <div id="chart5<%=activeSheetName%>" ><div id="ajax-spinner" style="z-index: 100;"><img src="/media/ajax-pulse.gif"/></div></div>
      </div>
    </div>
  </div>
</div>
<div class="endpage"></div>
<div class="row">
  <div class="row">
   <div class="col-md-12">
      <div class="panel panel-default">
      <div class="panel-body">
     <strong> Numero paz. per farmaco </strong>
          <div id='dataTable1<%=activeSheetName%>' ><div id="ajax-spinner" style="z-index: 100;"><img src="/media/ajax-pulse.gif"/></div></div>
          <hr/>
         
           <strong>  Distribuz. % dei paz. per farmaco</strong>
           <div id='dataTable2<%=activeSheetName%>' ><div id="ajax-spinner" style="z-index: 100;"><img src="/media/ajax-pulse.gif"/></div></div>
      </div>
</div>
</div>
</div>
</div>


